<!DOCTYPE html><html class="appearance-auto" lang="en"><head><meta charset="UTF-8"><title>零基础快速搭建公开数据集python爬虫</title><meta name="description" content="一个码痴, 为码而生"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><!-- End Google Analytics -->
<!-- Baidu Analytics --><!-- End Baidu Analytics --><link rel="icon" href="/myblog/images/%E5%A4%B4%E5%83%8F.jpg"><link rel="stylesheet" href="/myblog/style/common/bulma.css"><link rel="stylesheet" href="/myblog/style/base.css"><link rel="stylesheet" href="/myblog/style/common/helper.css"><script src="/myblog/js/common.js"></script><link rel="stylesheet" href="/myblog/style/post.css"><link rel="stylesheet" href="/myblog/style/themes/highlight-theme-light.css"><script src="/myblog/js/highlight.pack.js"></script><meta name="description" content="
引言最近接到老板任务，需要重新下载前段时间下过的一个数据集。这个数据集网站有多反人类呢？我们前段时间两个人断断续续点了三天才下载完。原因是数据集本身是多条的，如果点击合并下载， 系统后台会先把所有的数据压缩成一个文件，再给你这个压缩包的下载链接。一次打包数量稍微多一点点就会打包失败， 即使成功了， 打包的时间爆炸长。一共几千条数据， 大概每次只能点二三十个， 要经历打包-下载-解压-归类， 还得和下一批数据起始位置衔接好， 还要两个人分工好。 第一次下载这个数据集的时候我都快吐了。身为一个具有hacker精神的人， 我不容许自己再这么蠢。 好奇心的驱使下， 花了4个小时零基础终于完成了爬虫代码， 优化了2个人3天的耗时。

几千条数据需要分段勾选


这里就点了十几个，半分钟了打包进度还是0%

问题初探.."><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.2.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/myblog/atom.xml" title="MatrixMan's blog" type="application/atom+xml">
</head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/myblog/">Coding Fxxker's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">零基础快速搭建公开数据集python爬虫</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">Click back to the top</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/myblog/">Home</a></h3><h3 class="is-inline-block"><a href="/myblog/about">About</a></h3><h3 class="is-inline-block"><a href="/myblog/archives">Archives</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/myblog/">Home</a></h3><h3 class="is-inline-block"><a href="/myblog/about">About</a></h3><h3 class="is-inline-block"><a href="/myblog/archives">Archives</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E8%A8%80"><span class="toc-text">引言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E5%88%9D%E6%8E%A2"><span class="toc-text">问题初探</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E5%86%8D%E6%8E%A2"><span class="toc-text">问题再探</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E8%AE%B0"><span class="toc-text">后记</span></a></li></ol></div><div class="column is-9"><header class="my-4"><a href="/myblog/tags/%E7%88%AC%E8%99%AB"><i class="tag post-item-tag">爬虫</i></a></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">零基础快速搭建公开数据集python爬虫</h1><time class="has-text-grey" datetime="2021-07-05T12:13:45.000Z">2021-07-05</time><article class="mt-2 post-content"><p><img src="/myblog/2021/07/05/%E9%9B%B6%E5%9F%BA%E7%A1%80%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E5%85%AC%E5%BC%80%E6%95%B0%E6%8D%AE%E9%9B%86python%E7%88%AC%E8%99%AB/%E7%88%AC%E8%99%AB.jpg"></p>
<h3 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h3><p>最近接到老板任务，需要重新下载前段时间下过的一个数据集。这个数据集网站有多反人类呢？我们前段时间两个人断断续续点了三天才下载完。原因是数据集本身是多条的，如果点击合并下载， 系统后台会先把所有的数据压缩成一个文件，再给你这个压缩包的下载链接。一次打包数量稍微多一点点就会打包失败， 即使成功了， 打包的时间爆炸长。一共几千条数据， 大概每次只能点二三十个， 要经历打包-下载-解压-归类， 还得和下一批数据起始位置衔接好， 还要两个人分工好。 第一次下载这个数据集的时候我都快吐了。身为一个具有hacker精神的人， 我不容许自己再这么蠢。 好奇心的驱使下， 花了4个小时零基础终于完成了爬虫代码， 优化了2个人3天的耗时。</p>
<p><img src="/myblog/2021/07/05/%E9%9B%B6%E5%9F%BA%E7%A1%80%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E5%85%AC%E5%BC%80%E6%95%B0%E6%8D%AE%E9%9B%86python%E7%88%AC%E8%99%AB/%E6%A0%B7%E4%BE%8B1.jpg" alt="几千条数据需要分段勾选" title="几千条数据需要分段勾选"></p>
<center>几千条数据需要分段勾选</center>

<p><img src="/myblog/2021/07/05/%E9%9B%B6%E5%9F%BA%E7%A1%80%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E5%85%AC%E5%BC%80%E6%95%B0%E6%8D%AE%E9%9B%86python%E7%88%AC%E8%99%AB/%E6%A0%B7%E4%BE%8B2.png" alt="这里就点了十几个，半分钟了打包进度还是0%" title="这里就点了十几个，半分钟了打包进度还是0%"></p>
<center>这里就点了十几个，半分钟了打包进度还是0%</center>

<h3 id="问题初探"><a href="#问题初探" class="headerlink" title="问题初探"></a>问题初探</h3><p>首先经尝试发现， 每条数据单独下载是非常快的， 因为不用网站后台打包。那么很自然而然的思路就是， 如果能爬到每条数据背后的下载链接， 再依次下载， 便大功告成。 幸运的是， 笔者之前了解过浏览器(比如Windows Edge)一般都有一个开发者模式, 直觉告诉我, 右键点击每条数据链接，一定会有发现。经过尝试，右键点击检查，会直接定位到html文本(html 简单来说就是定义了整个网页布局)对应位置</p>
<p><img src="/myblog/2021/07/05/%E9%9B%B6%E5%9F%BA%E7%A1%80%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E5%85%AC%E5%BC%80%E6%95%B0%E6%8D%AE%E9%9B%86python%E7%88%AC%E8%99%AB/%E5%8F%B3%E9%94%AE.jpg" alt="下载链接右键菜单" title="下载链接右键菜单"></p>
<center>下载链接右键菜单</center>  

<p><img src="/myblog/2021/07/05/%E9%9B%B6%E5%9F%BA%E7%A1%80%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E5%85%AC%E5%BC%80%E6%95%B0%E6%8D%AE%E9%9B%86python%E7%88%AC%E8%99%AB/html.jpg" alt="左边是页面中某条数据， 右边是查到的对应html代码块" title="左边是页面中某条数据， 右边是查到的对应html代码块"></p>
<center>左边是页面中某条数据， 右边是查到的对应html代码块</center>    
<br>接下来只需要爬取整个html文本到本地再解析即可。 这里其实遇到一个小问题，下载页面是下拉扩展式的，也就是必须鼠标拉到底，才能获取后面的数据。经过查阅得知， 这是分页式页面，需要爬虫模拟鼠标下拉，解决方案是有， 但我选择直接手动下拉到底，因此浏览器元素审查模块中加载了全部信息，直接复制到本地即可。



<h3 id="问题再探"><a href="#问题再探" class="headerlink" title="问题再探"></a>问题再探</h3><p>下面要进行html解析，首先要知道，html 和 xml 类似, 都具有树形结构。 经过观察，所有的下载链接均在</p>
<pre><code class="html">&lt;li&gt;&lt;a class="op download" href="/xxxxx?dl=1"&gt;下载&lt;/a&gt;&lt;/li&gt;</code></pre>
<p>这样式的href里。解析代码如下:</p>
<pre><code class="python">from bs4 import BeautifulSoup
with open('raw.html', encoding='utf-8') as f:
        soup = BeautifulSoup(f,'html.parser')
    l = soup.find_all(name='a', attrs={'class':'op download'}) # 递归全文搜索 从叫a的结构体中找属性为 op download</code></pre>
<p>这里使用 BeautifulSoup4 解析库， l 返回的是所有下载链接的href所组成的列表。</p>
<p>根据href尝试爬取(代码隐去关键信息)</p>
<pre><code class="python">import request
import tqdm

for item in tqdm.tqdm(l):
    dladdress = "某域名" + item['href'] # href 路径为数据库后台相对路径, 我们外网访问需要加公网域名
    source = requests.get(url=dladdress, verify=False)</code></pre>
<p>返回</p>
<pre><code>b'\n\n\n&lt;!DOCTYPE html&gt;\n&lt;html lang="en"&gt;\n&lt;head&gt;\n&lt;title&gt;Log In - Private Seafile&lt;/title&gt;\n&lt;meta http-equiv="Content-type" content="text/html; charset=utf-8" /&gt;\n&lt;meta name="keywords" content="File Collaboration Team Organization" /&gt;\n\n&lt;meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" /&gt;\n\n&lt;meta http-equiv="x-ua-compatible" content="ie=edge" /&gt;\n&lt;link rel="shortcut icon" href="/media/custom/favicon.ico" /&gt;\n&lt;link rel="stylesheet" type="text/css" href="/media/assets/css/bootstrap.min.b00faad199b5.css"/&gt;\n&lt;link rel="stylesheet" type="text/css" href="/media/css/jstree_default_theme/style.min.css" /&gt;\n&lt;link rel="stylesheet" type="text/css" href="/media/assets/css/magnific-popup.656241b2c8ed.css" /&gt;\n&lt;link rel="stylesheet" type="text/css" href="/media/css/seahub.min.css?t=1516678381" /&gt;\n\n&lt;style type="text/css"&gt;\nhtml, body, #wrapper { height:100%; }\n#wrapper {\n    background: url(\'/media/custom/login-bg.jpg\') center top no-repeat scroll;\n    background-size: cover;\n    padding-top:1px;\n}\n#main {\n    min-height:0;\n}\n#lang {\n    margin:0;\n}\n#lang-context {\n    font-weight:normal;\n}\n#lang-context-selector {\n    text-align:left;\n}\n&lt;/style&gt;\n\n\n&lt;/head&gt;\n\n&lt;body&gt;\n    &lt;div id="wrapper" class="en"&gt;\n        \n        \n        \n\n        &lt;div id="header" class="navbar hide"&gt;\n            &lt;div id="header-inner"&gt;\n                \n                &lt;a href="/" id="logo" class="fleft"&gt;\n                    \n                    &lt;img src="/media/custom/mylogo.png" title="Private Seafile" alt="logo" width="244" height="32" /&gt;\n                    \n                &lt;/a&gt;\n                &lt;button class="sf2-icon-list-view side-nav-toggle hidden-md-up hide" title="Side Nav Menu" id="js-toggle-side-nav" aria-label="Side Nav Menu"&gt;&lt;/button&gt;\n\n                \n                 \n                &lt;div class="fright" id="lang"&gt;\n                    &lt;a href="#" id="lang-context" data-lang="en"&gt;English &lt;span class="icon-caret-down"&gt;&lt;/span&gt;&lt;/a&gt;\n                    &lt;div id="lang-context-selector" class="sf-popover hide"&gt;\n                        &lt;ul class="sf-popover-con"&gt;\n                            \n                            &lt;li&gt;&lt;a href="/i18n/?lang=en"&gt;English&lt;/a&gt;&lt;/li&gt;\n                            \n                            &lt;li&gt;&lt;a href="/i18n/?lang=zh-cn"&gt;\xe7\xae\x80\xe4\xbd\x93\xe4\xb8\xad\xe6\x96\x87&lt;/a&gt;&lt;/li&gt;\n                            \n                        &lt;/ul&gt;\n                    &lt;/div&gt;\n                &lt;/div&gt;\n                \n                \n            &lt;/div&gt;\n        &lt;/div&gt;\n\n        &lt;div id="main" class="clear container-fluid "&gt;\n            \n&lt;div class="login-panel-outer-container vh"&gt;\n&lt;div class="login-panel"&gt;\n    &lt;h1 class="login-panel-hd"&gt;Log In&lt;/h1&gt;\n    &lt;form action="" method="post" onsubmit="return check()"&gt;&lt;input type=\'hidden\' name=\'csrfmiddlewaretoken\' value=\'C75XMAtbeRg9m2r4emT46uLhV4oYW8vE\' /&gt;\n        &lt;input type="text" name="login" placeholder="Email or Username" aria-label="Email or Username" title="Email or Username" value="" class="input name-input" /&gt;&lt;br /&gt;\n        &lt;input type="password" name="password" placeholder="Password" aria-label="Password" title="Password" value="" class="input passwd-input" autocomplete="off" /&gt;\n\n        \n\n        &lt;input type="hidden" name="next" value="/lib/a37c012b-31cb-416b-b3e2-80589b19b3ff/file/L/hyper/053065_2-20x-roi6.raw?dl=1" /&gt;\n        \n        &lt;p class="error hide"&gt;&lt;/p&gt;\n        \n\n        &lt;label class="checkbox-label remember"&gt;\n            &lt;input type="checkbox" name="remember_me" class="vam remember-input" /&gt;\n            &lt;span class="vam"&gt;Remember me for 7 days &lt;/span&gt;\n        &lt;/label&gt;\n        &lt;a href="/accounts/password/reset/" class="normal forgot-passwd"&gt;Forgot password?&lt;/a&gt;\n\n        &lt;button type="submit" class="submit"&gt;Log In&lt;/button&gt;\n    &lt;/form&gt;\n\n    \n\n    \n\n    \n\n    \n\n    &lt;div class="login-panel-bottom-container"&gt;\n        \n        &lt;a href="/accounts/register/" class="normal fleft" id="sign-up"&gt;Signup&lt;/a&gt;\n        \n    &lt;/div&gt;\n&lt;/div&gt;\n&lt;/div&gt;\n\n\n            \n            &lt;div id="confirm-popup" class="hide"&gt;\n                &lt;div id="confirm-con"&gt;&lt;/div&gt;\n                &lt;button id="confirm-yes"&gt;Yes&lt;/button&gt;\n                &lt;button class="simplemodal-close"&gt;No&lt;/button&gt;\n            &lt;/div&gt;\n        &lt;/div&gt;\n\n&lt;/div&gt;&lt;!-- wrapper --&gt;\n\n&lt;script type="text/javascript" src="/media/js/jquery-1.12.1.min.js" id="jquery"&gt;&lt;/script&gt;\n&lt;script type="text/javascript" src="/media/assets/scripts/lib/jquery.simplemodal.67fb20a63282.js"&gt;&lt;/script&gt;\n&lt;script type="text/javascript" src="/media/assets/scripts/lib/jquery.ui.tabs.7406a3c5d2e3.js"&gt;&lt;/script&gt;\n&lt;script type="text/javascript" src="/media/assets/scripts/lib/jstree.min.baba5642f663.js"&gt;&lt;/script&gt;\n&lt;script type="text/javascript" src="/media/js/jq.min.js"&gt;&lt;/script&gt;\n&lt;script type="text/javascript" src="/media/js/base.js?t=1516678381"&gt;&lt;/script&gt;\n&lt;script type="text/javascript"&gt;\nfunction ajaxErrorHandler(xhr, textStatus, errorThrown) {\n    if (xhr.responseText) {\n        feedback($.parseJSON(xhr.responseText).error||$.parseJSON(xhr.responseText).error_msg, \'error\');\n    } else {\n        feedback("Failed. Please check the network.", \'error\');\n    }\n}\n \n(function() {\n    var lang_context = $(\'#lang-context\'),\n        lang_selector = $(\'#lang-context-selector\');\n\n    lang_context.parent().css({\'position\':\'relative\'});\n\n    if ($(\'#header\').is(\':visible\')) { // for login page\n        lang_selector.css({\n            \'top\': lang_context.position().top + lang_context.height() + 5,\n            \'right\': 0\n        });\n    }\n\n    var setLangSelectorMaxHeight = function() {\n        if ($(\'#header\').is(\':visible\')) { // for login page\n            $(\'.sf-popover-con\', lang_selector).css({\n                \'max-height\': $(window).height() - lang_selector.offset().top - 12\n            });\n        }\n    };\n    $(window).resize(function() {\n        if (lang_selector.is(\':visible\')) {\n            setLangSelectorMaxHeight();\n        }\n    });\n\n    lang_context.click(function() {\n        lang_selector.toggleClass(\'hide\');\n        if (lang_selector.is(\':visible\')) {\n            setLangSelectorMaxHeight();\n        }\n        return false;\n    });\n\n    $(document).click(function(e) {\n        var element = e.target || e.srcElement;\n        if (element.id != \'lang-context-selector\' &amp;&amp; element.id != \'lang-context\') {\n            lang_selector.addClass(\'hide\');\n        }\n    });\n})();\n\n\nif ($(\'.side-nav\').length) {\n    $(\'#logo\').addClass(\'hidden-sm-down\');\n    $(\'#js-toggle-side-nav\').removeClass(\'hide\');\n}\n$(\'#js-toggle-side-nav\').click(function() {\n    $(\'.side-nav\').css({\'left\': 0});\n    return false;\n});\n$(\'.js-close-side-nav\').click(function() {\n    $(\'.side-nav\').css({\'left\': \'-300px\'});\n    return false;\n});\n$(window).resize(function() {\n    if ($(window).width() &gt;= 768) {\n        $(\'.side-nav\').css({\'left\': 0});\n    }\n});\n&lt;/script&gt;\n\n&lt;script src="../../media/js/crypto-js.js"&gt;&lt;/script&gt;\n&lt;!--&lt;script src="../../media/js/md5.js"&gt;&lt;/script&gt;--&gt;\n&lt;!--&lt;script type="text/javascript" src="http://www.osctools.net/js/CryptoJS/components/core-min.js"&gt;&lt;/script&gt;--&gt;\n&lt;!--&lt;script type="text/javascript" src="http://www.osctools.net/js/CryptoJS/rollups/md5.js"&gt;&lt;/script&gt;--&gt;\n&lt;script type="text/javascript"&gt;\n// $(\'.login-panel-outer-container\').prepend($($(\'#logo\').html()).attr({\'width\': 160, \'height\':40}).addClass(\'login-panel-logo\'));\n$(\'.login-panel-bottom-container\').append($(\'#lang\').removeClass(\'fright\'));\n\nvar $el = $(\'.login-panel-outer-container\');\nvar elHeight = $el.outerHeight();\nvar wdHeight = $(window).height();\nif (wdHeight &gt; elHeight) {\n    $el.css({\'margin-top\': (wdHeight - elHeight)/2});\n}\n$(\'#lang\').css({\'margin-left\': $(\'#sign-up\').outerWidth() + 10});\n$el.removeClass(\'vh\');\n\n$(\'#lang-context-selector\').css({\n    \'top\': \'-\' + ($(\'#lang\').offset().top - 5) + \'px\',\n    \'right\': 0\n});\n$(\'#lang-context-selector .sf-popover-con\').css({\n    \'max-height\': $(\'#lang\').offset().top - 10\n});\n\n$(\'[name="login"]\').focus();\n\n//my function\nfunction check(){\nconst key = CryptoJS.enc.Utf8.parse("1234123412ABCDEF"); \nconst iv = CryptoJS.enc.Utf8.parse(\'ABCDEF1234123412\'); \nvar password=$(\'input[name="password"]\').val();\nlet srcs = CryptoJS.enc.Utf8.parse(password);\nlet encrypted = CryptoJS.AES.encrypt(srcs, key, { iv: iv, mode: CryptoJS.mode.CBC, padding: CryptoJS.pad.Pkcs7 });\nvar newpass=encrypted.ciphertext.toString().toUpperCase();\n//var newpass="12121212";\n//$("#password").val(password);\n//$(\'input[type="password"]\').attr(\'value\',password);\n$(\'input[name="password"]\').val(newpass);\n//$(\'input[name="password"]\').attr(\'value\',password);\nreturn true;\n}\n\nfunction setCaptchaInputWidth() {\n    $(\'#id_captcha_1\').outerWidth($(\'.input\').outerWidth() - $(\'.captcha\').width() - $(\'#refresh-captcha\').outerWidth(true) - 10);\n}\n$(window).load(setCaptchaInputWidth);\n$(\'.captcha\').load(setCaptchaInputWidth);\n$(\'#refresh-captcha\').click(function() {\n    $.ajax({\n        url: \'/captcha/refresh/\',\n        dataType:\'json\',\n        cache:false,\n        success: function(data) {\n            $(\'.captcha\').attr(\'src\', data[\'image_url\']);\n            $(\'#id_captcha_0\').val(data[\'key\']);\n        },\n        error: function() {\n            $(\'.error\').removeClass(\'hide\').html("Failed to refresh the CAPTCHA, please try again later.");\n        }\n    });\n    return false;\n});\n\n$(\'input[type="submit"]\').click(function(){\n    if (!$.trim($(\'input[name="login"]\').val())) {\n        $(\'.error\').removeClass(\'hide\').html("Email or username cannot be blank");\n        return false;\n    }\n    if (!$.trim($(\'input[name="password"]\').val())) {\n        $(\'.error\').removeClass(\'hide\').html("Password cannot be blank");\n        return false;\n    }\n});\n// set tabindex\n$(function() {\n    $(\'input:not([type="hidden"])\').each(function(index) {\n        $(this).attr(\'tabindex\', index + 1);\n    });\n});\n\n\n\n\n\n\n&lt;/script&gt;\n\n&lt;/body&gt;\n&lt;/html&gt;\n'Code Formats for Web Development - Open Social Communication Toolsb'\n\n\n&lt;!DOCTYPE html&gt;\n&lt;html lang="en"&gt;\n&lt;head&gt;\n&lt;title&gt;Log In - Private Seafile&lt;/title&gt;\n&lt;meta http-equiv="Content-type" content="text/html; charset=utf-8" /&gt;\n&lt;meta name="keywords" content="File Collaboration Team Organization" /&gt;\n\n&lt;meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" /&gt;\n\n&lt;meta http-equiv="x-ua-compatible" content="ie=edge" /&gt;\n&lt;link rel="shortcut icon" href="/media/custom/favicon.ico" /&gt;\n&lt;link rel="stylesheet" type="text/css" href="/media/assets/css/bootstrap.min.b00faad199b5.css"/&gt;\n&lt;link rel="stylesheet" type="text/css" href="/media/css/jstree_default_theme/style.min.css" /&gt;\n&lt;link rel="stylesheet" type="text/css" href="/media/assets/css/magnific-popup.656241b2c8ed.css" /&gt;\n&lt;link rel="stylesheet" type="text/css" href="/media/css/seahub.min.css?t=1516678381" /&gt;\n\n&lt;style type="text/css"&gt;\nhtml, body, #wrapper { height:100%; }\n#wrapper {\n    background: url(\'/media/custom/login-bg.jpg\') center top no-repeat scroll;\n    background-size: cover;\n    padding-top:1px;\n}\n#main {\n    min-height:0;\n}\n#lang {\n    margin:0;\n}\n#lang-context {\n    font-weight:normal;\n}\n#lang-context-selector {\n    text-align:left;\n}\n&lt;/style&gt;\n\n\n&lt;/head&gt;\n\n&lt;body&gt;\n    &lt;div id="wrapper" class="en"&gt;\n        \n        \n        \n\n        &lt;div id="header" class="navbar hide"&gt;\n            &lt;div id="header-inner"&gt;\n                \n                &lt;a href="/" id="logo" class="fleft"&gt;\n                    \n                    &lt;img src="/media/custom/mylogo.png" title="Private Seafile" alt="logo" width="244" height="32" /&gt;\n                    \n                &lt;/a&gt;\n                &lt;button class="sf2-icon-list-view side-nav-toggle hidden-md-up hide" title="Side Nav Menu" id="js-toggle-side-nav" aria-label="Side Nav Menu"&gt;&lt;/button&gt;\n\n                \n                 \n                &lt;div class="fright" id="lang"&gt;\n                    &lt;a href="#" id="lang-context" data-lang="en"&gt;English &lt;span class="icon-caret-down"&gt;&lt;/span&gt;&lt;/a&gt;\n                    &lt;div id="lang-context-selector" class="sf-popover hide"&gt;\n                        &lt;ul class="sf-popover-con"&gt;\n                            \n                            &lt;li&gt;&lt;a href="/i18n/?lang=en"&gt;English&lt;/a&gt;&lt;/li&gt;\n                            \n                            &lt;li&gt;&lt;a href="/i18n/?lang=zh-cn"&gt;\xe7\xae\x80\xe4\xbd\x93\xe4\xb8\xad\xe6\x96\x87&lt;/a&gt;&lt;/li&gt;\n                            \n                        &lt;/ul&gt;\n                    &lt;/div&gt;\n                &lt;/div&gt;\n                \n                \n            &lt;/div&gt;\n        &lt;/div&gt;\n\n        &lt;div id="main" class="clear container-fluid "&gt;\n            \n&lt;div class="login-panel-outer-container vh"&gt;\n&lt;div class="login-panel"&gt;\n    &lt;h1 class="login-panel-hd"&gt;Log In&lt;/h1&gt;\n    &lt;form action="" method="post" onsubmit="return check()"&gt;&lt;input type=\'hidden\' name=\'csrfmiddlewaretoken\' value=\'C75XMAtbeRg9m2r4emT46uLhV4oYW8vE\' /&gt;\n        &lt;input type="text" name="login" placeholder="Email or Username" aria-label="Email or Username" title="Email or Username" value="" class="input name-input" /&gt;&lt;br /&gt;\n        &lt;input type="password" name="password" placeholder="Password" aria-label="Password" title="Password" value="" class="input passwd-input" autocomplete="off" /&gt;\n\n        \n\n        &lt;input type="hidden" name="next" value="/lib/a37c012b-31cb-416b-b3e2-80589b19b3ff/file/L/hyper/053065_2-20x-roi6.raw?dl=1" /&gt;\n        \n        &lt;p class="error hide"&gt;&lt;/p&gt;\n        \n\n        &lt;label class="checkbox-label remember"&gt;\n            &lt;input type="checkbox" name="remember_me" class="vam remember-input" /&gt;\n            &lt;span class="vam"&gt;Remember me for 7 days &lt;/span&gt;\n        &lt;/label&gt;\n        &lt;a href="/accounts/password/reset/" class="normal forgot-passwd"&gt;Forgot password?&lt;/a&gt;\n\n        &lt;button type="submit" class="submit"&gt;Log In&lt;/button&gt;\n    &lt;/form&gt;\n\n    \n\n    \n\n    \n\n    \n\n    &lt;div class="login-panel-bottom-container"&gt;\n        \n        &lt;a href="/accounts/register/" class="normal fleft" id="sign-up"&gt;Signup&lt;/a&gt;\n        \n    &lt;/div&gt;\n&lt;/div&gt;\n&lt;/div&gt;\n\n\n            \n            &lt;div id="confirm-popup" class="hide"&gt;\n                &lt;div id="confirm-con"&gt;&lt;/div&gt;\n                &lt;button id="confirm-yes"&gt;Yes&lt;/button&gt;\n                &lt;button class="simplemodal-close"&gt;No&lt;/button&gt;\n            &lt;/div&gt;\n        &lt;/div&gt;\n\n&lt;/div&gt;&lt;!-- wrapper --&gt;\n\n&lt;script type="text/javascript" src="/media/js/jquery-1.12.1.min.js" id="jquery"&gt;&lt;/script&gt;\n&lt;script type="text/javascript" src="/media/assets/scripts/lib/jquery.simplemodal.67fb20a63282.js"&gt;&lt;/script&gt;\n&lt;script type="text/javascript" src="/media/assets/scripts/lib/jquery.ui.tabs.7406a3c5d2e3.js"&gt;&lt;/script&gt;\n&lt;script type="text/javascript" src="/media/assets/scripts/lib/jstree.min.baba5642f663.js"&gt;&lt;/script&gt;\n&lt;script type="text/javascript" src="/media/js/jq.min.js"&gt;&lt;/script&gt;\n&lt;script type="text/javascript" src="/media/js/base.js?t=1516678381"&gt;&lt;/script&gt;\n&lt;script type="text/javascript"&gt;\nfunction ajaxErrorHandler(xhr, textStatus, errorThrown) {\n    if (xhr.responseText) {\n        feedback($.parseJSON(xhr.responseText).error||$.parseJSON(xhr.responseText).error_msg, \'error\');\n    } else {\n        feedback("Failed. Please check the network.", \'error\');\n    }\n}\n \n(function() {\n    var lang_context = $(\'#lang-context\'),\n        lang_selector = $(\'#lang-context-selector\');\n\n    lang_context.parent().css({\'position\':\'relative\'});\n\n    if ($(\'#header\').is(\':visible\')) { // for login page\n        lang_selector.css({\n            \'top\': lang_context.position().top + lang_context.height() + 5,\n            \'right\': 0\n        });\n    }\n\n    var setLangSelectorMaxHeight = function() {\n        if ($(\'#header\').is(\':visible\')) { // for login page\n            $(\'.sf-popover-con\', lang_selector).css({\n                \'max-height\': $(window).height() - lang_selector.offset().top - 12\n            });\n        }\n    };\n    $(window).resize(function() {\n        if (lang_selector.is(\':visible\')) {\n            setLangSelectorMaxHeight();\n        }\n    });\n\n    lang_context.click(function() {\n        lang_selector.toggleClass(\'hide\');\n        if (lang_selector.is(\':visible\')) {\n            setLangSelectorMaxHeight();\n        }\n        return false;\n    });\n\n    $(document).click(function(e) {\n        var element = e.target || e.srcElement;\n        if (element.id != \'lang-context-selector\' &amp;&amp; element.id != \'lang-context\') {\n            lang_selector.addClass(\'hide\');\n        }\n    });\n})();\n\n\nif ($(\'.side-nav\').length) {\n    $(\'#logo\').addClass(\'hidden-sm-down\');\n    $(\'#js-toggle-side-nav\').removeClass(\'hide\');\n}\n$(\'#js-toggle-side-nav\').click(function() {\n    $(\'.side-nav\').css({\'left\': 0});\n    return false;\n});\n$(\'.js-close-side-nav\').click(function() {\n    $(\'.side-nav\').css({\'left\': \'-300px\'});\n    return false;\n});\n$(window).resize(function() {\n    if ($(window).width() &gt;= 768) {\n        $(\'.side-nav\').css({\'left\': 0});\n    }\n});\n&lt;/script&gt;\n\n&lt;script src="../../media/js/crypto-js.js"&gt;&lt;/script&gt;\n&lt;!--&lt;script src="../../media/js/md5.js"&gt;&lt;/script&gt;--&gt;\n&lt;!--&lt;script type="text/javascript" src="http://www.osctools.net/js/CryptoJS/components/core-min.js"&gt;&lt;/script&gt;--&gt;\n&lt;!--&lt;script type="text/javascript" src="http://www.osctools.net/js/CryptoJS/rollups/md5.js"&gt;&lt;/script&gt;--&gt;\n&lt;script type="text/javascript"&gt;\n// $(\'.login-panel-outer-container\').prepend($($(\'#logo\').html()).attr({\'width\': 160, \'height\':40}).addClass(\'login-panel-logo\'));\n$(\'.login-panel-bottom-container\').append($(\'#lang\').removeClass(\'fright\'));\n\nvar $el = $(\'.login-panel-outer-container\');\nvar elHeight = $el.outerHeight();\nvar wdHeight = $(window).height();\nif (wdHeight &gt; elHeight) {\n    $el.css({\'margin-top\': (wdHeight - elHeight)/2});\n}\n$(\'#lang\').css({\'margin-left\': $(\'#sign-up\').outerWidth() + 10});\n$el.removeClass(\'vh\');\n\n$(\'#lang-context-selector\').css({\n    \'top\': \'-\' + ($(\'#lang\').offset().top - 5) + \'px\',\n    \'right\': 0\n});\n$(\'#lang-context-selector .sf-popover-con\').css({\n    \'max-height\': $(\'#lang\').offset().top - 10\n});\n\n$(\'[name="login"]\').focus();\n\n//my function\nfunction check(){\nconst key = CryptoJS.enc.Utf8.parse("1234123412ABCDEF"); \nconst iv = CryptoJS.enc.Utf8.parse(\'ABCDEF1234123412\'); \nvar password=$(\'input[name="password"]\').val();\nlet srcs = CryptoJS.enc.Utf8.parse(password);\nlet encrypted = CryptoJS.AES.encrypt(srcs, key, { iv: iv, mode: CryptoJS.mode.CBC, padding: CryptoJS.pad.Pkcs7 });\nvar newpass=encrypted.ciphertext.toString().toUpperCase();\n//var newpass="12121212";\n//$("#password").val(password);\n//$(\'input[type="password"]\').attr(\'value\',password);\n$(\'input[name="password"]\').val(newpass);\n//$(\'input[name="password"]\').attr(\'value\',password);\nreturn true;\n}\n\nfunction setCaptchaInputWidth() {\n    $(\'#id_captcha_1\').outerWidth($(\'.input\').outerWidth() - $(\'.captcha\').width() - $(\'#refresh-captcha\').outerWidth(true) - 10);\n}\n$(window).load(setCaptchaInputWidth);\n$(\'.captcha\').load(setCaptchaInputWidth);\n$(\'#refresh-captcha\').click(function() {\n    $.ajax({\n        url: \'/captcha/refresh/\',\n        dataType:\'json\',\n        cache:false,\n        success: function(data) {\n            $(\'.captcha\').attr(\'src\', data[\'image_url\']);\n            $(\'#id_captcha_0\').val(data[\'key\']);\n        },\n        error: function() {\n            $(\'.error\').removeClass(\'hide\').html("Failed to refresh the CAPTCHA, please try again later.");\n        }\n    });\n    return false;\n});\n\n$(\'input[type="submit"]\').click(function(){\n    if (!$.trim($(\'input[name="login"]\').val())) {\n        $(\'.error\').removeClass(\'hide\').html("Email or username cannot be blank");\n        return false;\n    }\n    if (!$.trim($(\'input[name="password"]\').val())) {\n        $(\'.error\').removeClass(\'hide\').html("Password cannot be blank");\n        return false;\n    }\n});\n// set tabindex\n$(function() {\n    $(\'input:not([type="hidden"])\').each(function(index) {\n        $(this).attr(\'tabindex\', index + 1);\n    });\n});\n\n\n\n\n\n\n&lt;/script&gt;\n\n&lt;/body&gt;\n&lt;/html&gt;\n'</code></pre>
<p>虽然看不懂是什么， 但大概知道是没账号密码。联想到手动下载时只需要一开始登陆，那么这里request请求一定需要cookie而不是输入账号密码, 我们需要<strong>模拟保存cookie的浏览器请求</strong>。Edge浏览器打开数据集网站，按F12， 点击应用程序，左侧选择 cookie，会出现明文名称-值，用python字典将其存储，作为参数输入request。http协议还需要一个请求头(就笔者爬的这个网站来说，没有请求头也行, 读者有兴趣可以看看http协议)，完整爬取代码如下：</p>
<p><img src="/myblog/2021/07/05/%E9%9B%B6%E5%9F%BA%E7%A1%80%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E5%85%AC%E5%BC%80%E6%95%B0%E6%8D%AE%E9%9B%86python%E7%88%AC%E8%99%AB/cookie.jpg" alt="Edge查找网站保存的Cookie" title="Edge查找网站保存的Cookie"></p>
<center>Edge查找网站保存的Cookie</center>    
<br>

<pre><code class="python">import os
from threading import Thread

import requests
import tqdm
from bs4 import BeautifulSoup

requests.packages.urllib3.disable_warnings()


def crawler(l):
    # 模拟火狐浏览器登陆
    header = {'User-Agent': 'Mozilla/5.0 (Windows NT 6.1; Win64; x64)'}
    # 字典内部保存为字符串, 从浏览器开发者模式中读取
    cookies = { 'XXX': 'XXX',
                'XXX': 'XXX',
                'XXX': 'XXX'}

    for item in tqdm.tqdm(l):
        dladdress = "某域名" + item['href']
        source = requests.get(url=dladdress, cookies=cookies, headers=header,verify=False)#取消安全验证
        name = source.headers['Content-Disposition'].split(' ')[1][1:-1] #从网站响应header中获得文件名
        if source.status_code == 200:   #响应代码200 表示访问成功，http 协议规定
            with open('./hyper/' + name, 'wb') as fp:
                fp.write(source.content)
                fp.close()


if __name__ == '__main__':

    with open('raw.html', encoding='utf-8') as f:  # raw.html 是浏览器手动下载下来的html文件

        soup = BeautifulSoup(f,'html.parser')

    l = soup.find_all(name='a', attrs={'class':'op download'})

    ThreadPool = []

    tasknum = 5  #设置5线程爬取数据

    interval = len(l)//(tasknum) + 1 # 每个线程分配的任务数, +1代表最后一个线程分配任务数必然大于所剩任务

    for i in range(tasknum):  
        ThreadPool.append(Thread(target=crawler, args=([l[i*interval:(i+1)*interval]]),))  
    # 线程池中添加一个线程
    # 注意这个线程池是一个广义的概念
    # 你可以用任意数据结构来实现
    # 方便存入、操作线程对象即可
    for p in ThreadPool:
        p.start()
    for p in ThreadPool:
        p.join()
</code></pre>
<p>大功告成！ Enjoy it!</p>
<h3 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h3><p>笔者之前几乎未接触过爬虫方面，甚至网络方面知识，虽然最终代码只有几十行， 但探索的过程却是十分艰辛的，短时间内需要在众多过时爬虫文章中， 提炼出你所需要的。 我一向信奉问题驱动，虽然没有考虑各种爬虫因素(比如安全方面、反爬方面)，但简陋的代码还是帮我解决了迫切的问题，值得庆幸！</p>
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><em></em><a class="button is-default" href="/myblog/2021/05/19/pandas-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86/" title="pandas 多线程数据处理"><span class="has-text-weight-semibold">Next: pandas 多线程数据处理</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section><article class="mt-6 comment-container"><script async repo="Haojen/Claudia-theme-blog" src="https://utteranc.es/client.js" issue-term="pathname" theme="preferred-color-scheme"></script></article></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><a title="twitter" target="_blank" rel="noopener nofollow" href="//twitter.com/jmjkx111"><i class="iconfont icon-twitter"></i></a><!-- Github--><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/jmjkx"><i class="iconfont icon-github"></i></a><!-- Ins--><a title="instagram" target="_blank" rel="noopener nofollow" href="//www.instagram.com/jmjkx"><i class="iconfont icon-ins"></i></a><!-- RSS--><a title="rss" target="_blank" rel="noopener nofollow" href="/myblog/atom.xml"><i class="iconfont icon-rss"></i></a><!-- 知乎--><a title="zhihu" target="_blank" rel="noopener nofollow" href="//zhihu.com/people/codefxxker"><i class="iconfont icon-zhihu"></i></a><!-- 领英--><!-- 脸书--></section><p><span>Copyright ©</span><span> Coding Fxxker 2021</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo &verbar;&nbsp;</p><p class="is-flex is-justify-content-center"><a title="Hexo theme author" href="//github.com/haojen">Theme by Haojen&nbsp;</a></p><div style="margin-top: 2px"><a class="github-button" title="github-button" href="https://github.com/haojen/hexo-theme-Claudia" data-color-scheme="no-preference: light; light: light; dark: dark;" data-show-count="true"></a></div></div><div><span></span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/myblog/js/post.js"></script></body></html>